<div class="mx-1 h-full">
  <div class="component-container h-full">
    <div>
      <app-navigation-header
        [title]="isHabitToEdit ? 'Edit Habit' : 'Add New Habit'"
      ></app-navigation-header>

      <div class="grid px-3 mt-5">
        <div class="col-4">
          <div
            class="text-center border-round-sm font-bold icon-container"
            [ngStyle]="{
              'background-color': selectedColor?.hex
                ? selectedColor.hex
                : 'initial'
            }"
          >
            <span
              class="material-icons"
              [ngStyle]="{
                color: selectedColor?.textColor
                  ? selectedColor.textColor
                  : 'initial'
              }"
            >
              {{ iconSelectedCategory ? iconSelectedCategory : "category" }}
            </span>
          </div>
        </div>

        <div class="col-8 flex align-items-end">
          <p-dropdown
            [options]="categories"
            [(ngModel)]="selectedCategoryOptValue"
            [checkmark]="true"
            optionLabel="label"
            optionValue="id"
            [showClear]="true"
            placeholder="Select a Category"
            class="w-full-category w-full"
            (onChange)="onCategoryChange($event.value)"
          />
        </div>
      </div>
      <div class="mt-5 w-screen px-3 mx-auto pb-2">
        <p-floatLabel>
          <p-dropdown
            [options]="colors_categories"
            [(ngModel)]="selectedColorOptValue"
            optionLabel="name"
            optionValue="hex"
            [showClear]="true"
            placeholder="Select a Color"
            class="w-full-category w-full"
            (onChange)="onColorChange($event.value)"
          >
            <ng-template
              let-data
              pTemplate="item"
              *ngIf="colors_categories && colors_categories.length > 0"
            >
              <div class="flex align-items-center gap-2">
                <div
                  class="color-circle"
                  [style.background-color]="data.hex"
                ></div>
                <div>{{ data.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
          <label>Choose a color</label>
        </p-floatLabel>
      </div>
      <form [formGroup]="newHabitForm">
        <div class="new-habit-container mt-5">
          <!-- Titolo -->
          <div class="mt-5 w-screen px-3 mx-auto pb-2">
            <p-floatLabel>
              <input pInputText formControlName="title" />
              <label>Habit name</label>
            </p-floatLabel>
          </div>

          <!-- Start date</h4> -->
          <div class="mt-5 w-screen px-3 mx-auto pb-2">
            <p-floatLabel>
              <p-calendar
                [showButtonBar]="true"
                [touchUI]="true"
                formControlName="startDate"
                appendTo="body"
                dateFormat="dd/mm/yy"
                styleClass="w-screen"
                [showTime]="true"
                [hourFormat]="'24'"
              ></p-calendar>
              <label>Start date</label>
            </p-floatLabel>
          </div>

          <!-- End date -->
          <div class="mt-5 w-screen px-3 mx-auto pb-2">
            <p-floatLabel>
              <p-calendar
                [showButtonBar]="true"
                [touchUI]="true"
                formControlName="endDate"
                appendTo="body"
                dateFormat="dd/mm/yy"
                styleClass="w-screen"
                [showTime]="true"
                [hourFormat]="'24'"
                [minDate]="getMinDate()"
              ></p-calendar>
              <label>End date</label>
            </p-floatLabel>
          </div>

          <!-- colorpicker -->

          <div class="periodicity-container w-screen mx-auto px-3 my-5">
            <h4>Set periodicity</h4>
            <div class="days flex justify-content-center">
              <button
                *ngFor="let day of days; let i = index"
                [ngClass]="{ selected: selectedDays.includes(day.id) }"
                (click)="toggleDay(day.id)"
              >
                {{ day.label }}
              </button>
            </div>
          </div>

          <!-- reminder -->
          <div class="reminder w-screen mx-auto px-3">
            <p-floatLabel>
              <p-calendar
                [showTime]="true"
                hourFormat="12"
                [timeOnly]="true"
                formControlName="remind"
                [touchUI]="true"
                appendTo="body"
                styleClass="w-screen"
                [showClear]="true"
                (onClear)="onReminderClear()"
              ></p-calendar>

              <label>
                {{
                  newHabitForm.get("remind")?.value
                    ? "Reminder time notification"
                    : "No reminder time notifications selected"
                }}
              </label>
            </p-floatLabel>
          </div>
        </div>
      </form>
    </div>

    <div class="mt-5 mb-3">
      <p-button
        size="small"
        severity="danger"
        (onClick)="saveHabit()"
        [outlined]="true"
        [disabled]="!newHabitForm.valid"
        class="mr-2"
      >
        <span class="material-icons mr-2 text-base"> save </span>
        <span>{{ isHabitToEdit ? "Edit habit" : "Add new habit" }}</span>
      </p-button>

      <p-button *ngIf="isHabitToEdit" size="small" severity="danger" (click)="deleteHabit()">
        <span class="material-icons mr-2 text-base"> delete </span>
        <span>Delete</span>
      </p-button>
    </div>
  </div>
</div>
